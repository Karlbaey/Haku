---
import { getCollection } from "astro:content";

const collectionName = "articles";
const allArticles = await getCollection(collectionName);
// 在构建时，生成一个只包含必要信息（标题和链接）的轻量级数组
// 这样可以避免把整篇文章的内容都传给客户端
const articleList = allArticles.map((article) => ({
  title: article.data.title,
  href: `/${collectionName}/${article.data.permalink}/`,
}));
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>404 - 页面未找到</title>
    <style>
      body {
        margin: 0;
        font-family: "Noto Serif SC";
      }
      .container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        width: 90%;
        max-width: 600px;
      }
      .container h1 {
        margin: 0;
        font-size: 2.5rem;
        color: #333;
      }

      .container .nav-links {
        margin-top: 20px;
      }
      .container a {
        margin: 0 10px;
        color: #0077cc;
        text-decoration: none;
        font-size: 1.1rem;
      }
      .container a:hover {
        text-decoration: underline;
      }
      .random-post {
        margin-top: 60px;
        padding-top: 30px;
        border-top: 1px solid #e0e0e0;
        display: none;
      }
      .random-post h3 {
        color: #555;
        font-weight: normal;
        margin-bottom: 15px;
      }

      .random-post a {
        font-size: 1.2rem;
        font-weight: bold;
        color: #0055aa;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>404 Not Found</h1>

      <div class="nav-links">
        <a href="javascript:history.back(-1)">返回上一页</a>
        <a href="/">返回首页</a>
      </div>

      <div class="random-post" id="random-post-container">
        <h3>或许你对这篇文章感兴趣？</h3>
        <a href="#" id="random-post-link">加载中...</a>
      </div>
    </div>
    <script is:inline define:vars={{ articleList }}>
      if (articleList && articleList.length > 0) {
        const randomIndex = Math.floor(Math.random() * articleList.length);
        const randomArticle = articleList[randomIndex];

        const container = document.getElementById("random-post-container");
        const link = document.getElementById("random-post-link");

        if (container && link) {
          link.href = randomArticle.href;
          link.textContent = randomArticle.title;
          container.style.display = "block";
        }
      }
    </script>
  </body>
</html>
